<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>src/checkpoint/dispatch/vrt/virtual_serialize.h file | checkpoint</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon-dark.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">checkpoint</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li>
              <a href="ckpt_learn.html">Learn</a>
              <ol>
                <li><a href="ckpt_learn_build.html">How to Build</a></li>
                <li><a href="ckpt_learn_examples.html">Examples</a></li>
                <li><a href="ckpt_learn_serialize.html">How to Serialize Data</a></li>
              </ol>
            </li>
            <li><a href="pages.html">Pages</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li>
              <a href="https://github.com/">GitHub</a>
              <ol>
                <li><a href="https://github.com/DARMA-tasking/checkpoint">Checkpoint</a></li>
                <li><a href="https://github.com/DARMA-tasking/checkpoint-member-analyzer">Checkpoint Analyzer</a></li>
                <li><a href="https://github.com/DARMA-tasking/detector">Detector</a></li>
              </ol>
            </li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a>/</span><span class="m-breadcrumb"><a href="dir_f8a23b4b6ee8630a1187b0b1add2ade0.html">checkpoint</a>/</span><span class="m-breadcrumb"><a href="dir_7465b7a05c9903f1bfdf67a684d22729.html">dispatch</a>/</span><span class="m-breadcrumb"><a href="dir_c294adb07992ba9164aee30545219daf.html">vrt</a>/</span>virtual_serialize.h <span class="m-thin">file</span>
        </h1>
        <p><span></span></p>
        <nav class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#namespaces">Namespaces</a></li>
                <li><a href="#nested-classes">Classes</a></li>
                <li><a href="#func-members">Functions</a></li>
              </ul>
            </li>
          </ul>
        </nav>
        <section id="namespaces">
          <h2><a href="#namespaces">Namespaces</a></h2>
          <dl class="m-doc">
            <dt>namespace <a href="namespacecheckpoint.html" class="m-doc">checkpoint</a></dt>
            <dd><span></span></dd>
            <dt>namespace <a href="namespacecheckpoint_1_1dispatch.html" class="m-doc">checkpoint::dispatch</a></dt>
            <dd><span></span></dd>
            <dt>namespace <a href="namespacecheckpoint_1_1dispatch_1_1vrt.html" class="m-doc">checkpoint::dispatch::vrt</a></dt>
            <dd><span></span></dd>
          </dl>
        </section>
        <section id="nested-classes">
          <h2><a href="#nested-classes">Classes</a></h2>
          <dl class="m-doc">
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT, typename _enabled = void&gt;</div>
              struct <a href="structcheckpoint_1_1_serialize_virtual_type_if_needed.html" class="m-doc">checkpoint::SerializeVirtualTypeIfNeeded</a>
            </dt>
            <dd>Do a static trait test on type to check for virtual serializability.</dd>
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT&gt;</div>
              struct <a href="structcheckpoint_1_1_serialize_virtual_type_if_needed_3_01_t_00_01_serializer_t_00_01typename_01169395079d468e6ff618832a51e34843.html" class="m-doc">checkpoint::SerializeVirtualTypeIfNeeded&lt;T, SerializerT, typename std::enable_if_t&lt;dispatch::vrt::VirtualSerializeTraits&lt;T&gt;::has_not_virtual_serialize&gt;&gt;</a>
            </dt>
            <dd><span></span></dd>
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT&gt;</div>
              struct <a href="structcheckpoint_1_1_serialize_virtual_type_if_needed_3_01_t_00_01_serializer_t_00_01typename_019c8f7fc8348eb3352805b18f8a3adb0b.html" class="m-doc">checkpoint::SerializeVirtualTypeIfNeeded&lt;T, SerializerT, typename std::enable_if_t&lt;dispatch::vrt::VirtualSerializeTraits&lt;T&gt;::has_virtual_serialize&gt;&gt;</a>
            </dt>
            <dd><span></span></dd>
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT, typename _enabled = void&gt;</div>
              struct <a href="structcheckpoint_1_1_reconstruct_as_virtual_if_needed.html" class="m-doc">checkpoint::ReconstructAsVirtualIfNeeded</a>
            </dt>
            <dd>Do a static trait test on type to check for virtual serializability. If virtually serializable, we need to perform some extra work to register the type, allocate, and construct the proper type. Otherwise, we go through the normal path for allocating memory for T and serializing what the pointer points to.</dd>
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT&gt;</div>
              struct <a href="structcheckpoint_1_1_reconstruct_as_virtual_if_needed_3_01_t_00_01_serializer_t_00_01typename_01bd353309780a1641c6b4da6107e9b732.html" class="m-doc">checkpoint::ReconstructAsVirtualIfNeeded&lt;T, SerializerT, typename std::enable_if_t&lt;dispatch::vrt::VirtualSerializeTraits&lt;T&gt;::has_not_virtual_serialize and not std::is_same&lt;SerializerT, checkpoint::Footprinter&gt;::value&gt;&gt;</a>
            </dt>
            <dd><span></span></dd>
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT&gt;</div>
              struct <a href="structcheckpoint_1_1_reconstruct_as_virtual_if_needed_3_01_t_00_01_serializer_t_00_01typename_0185cb3961b0806c240679cf17dd651016.html" class="m-doc">checkpoint::ReconstructAsVirtualIfNeeded&lt;T, SerializerT, typename std::enable_if_t&lt;dispatch::vrt::VirtualSerializeTraits&lt;T&gt;::has_not_virtual_serialize and std::is_same&lt;SerializerT, checkpoint::Footprinter&gt;::value&gt;&gt;</a>
            </dt>
            <dd><span></span></dd>
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT&gt;</div>
              struct <a href="structcheckpoint_1_1_reconstruct_as_virtual_if_needed_3_01_t_00_01_serializer_t_00_01typename_01ab92c606a95e76aaa723ec61628f6529.html" class="m-doc">checkpoint::ReconstructAsVirtualIfNeeded&lt;T, SerializerT, typename std::enable_if_t&lt;dispatch::vrt::VirtualSerializeTraits&lt;T&gt;::has_virtual_serialize&gt;&gt;</a>
            </dt>
            <dd><span></span></dd>
          </dl>
        </section>
        <section id="func-members">
          <h2><a href="#func-members">Functions</a></h2>
          <dl class="m-doc">
            <dt>
              <div class="m-doc-template">template&lt;typename T, typename SerializerT&gt;</div>
              <span class="m-doc-wrap-bumper">void <a href="#ab62fa4e32b27853f6b57caf24b6a77cc" class="m-doc">virtualSerialize</a>(</span><span class="m-doc-wrap">T*&amp; base,
              SerializerT&amp; s)</span>
            </dt>
            <dd>A function to handle serialization of objects of a mix of types in a virtual inheritance hierarchy.</dd>
            <dt>
              <div class="m-doc-template">template&lt;typename SerializerT, typename T&gt;</div>
              <span class="m-doc-wrap-bumper">void <a href="#a9ffb72abb4d8c3fe031626dbf526d70c" class="m-doc">reconstructPointedToObjectIfNeeded</a>(</span><span class="m-doc-wrap">SerializerT&amp; s,
              T*&amp; target)</span>
            </dt>
            <dd>Allocate and construct memory for a pointer with type <code>T</code>.</dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="ab62fa4e32b27853f6b57caf24b6a77cc"><div>
            <h3>
              <div class="m-doc-template">
                template&lt;typename T, typename SerializerT&gt;
              </div>
              <span class="m-doc-wrap-bumper">void </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ab62fa4e32b27853f6b57caf24b6a77cc" class="m-doc-self">virtualSerialize</a>(</span><span class="m-doc-wrap">T*&amp; base,
              SerializerT&amp; s)</span></span>
            </h3>
            <p>A function to handle serialization of objects of a mix of types in a virtual inheritance hierarchy.</p>
<p>This will automatically record the exact derived type at serialization, and reconstruct objects accordingly at deserialization.</p>
          </div></section>
          <section class="m-doc-details" id="a9ffb72abb4d8c3fe031626dbf526d70c"><div>
            <h3>
              <div class="m-doc-template">
                template&lt;typename SerializerT, typename T&gt;
              </div>
              <span class="m-doc-wrap-bumper">void </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a9ffb72abb4d8c3fe031626dbf526d70c" class="m-doc-self">reconstructPointedToObjectIfNeeded</a>(</span><span class="m-doc-wrap">SerializerT&amp; s,
              T*&amp; target)</span></span>
            </h3>
            <p>Allocate and construct memory for a pointer with type <code>T</code>.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">s&nbsp;<span class="m-label m-flat m-info">in</span></td>
                  <td>the serializer</td>
                </tr>
                <tr>
                  <td>target&nbsp;<span class="m-label m-flat m-info">in</span></td>
                  <td>a reference to a pointer to the target object</td>
                </tr>
              </tbody>
            </table>
<p>This function automatically handles allocating and constructing the right type for virtually serialized pointers or non-virtual static allocation and construction.</p><p>An example of how to use this to properly serialize a std::shared_ptr&lt;T&gt;:</p><p>template &lt;typename t&gt;=&quot;&quot;&gt; struct X { std::shared_ptr&lt;T&gt; a;</p><p>template &lt;typename serializert&gt;=&quot;&quot;&gt; void serialize(SerializerT&amp; s) { T* raw = elm.get(); checkpoint::reconstructPointedToObjectIfNeeded(s, raw); if (s.isUnpacking()) { a = std::shared_ptr&lt;T&gt;(raw); } s | *a; } };</p>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v2.js"></script>
<script src="searchdata-v2.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>checkpoint. Created with <a href="https://doxygen.org/">Doxygen</a> 1.8.16 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
