<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DARMA &raquo; Introduction &raquo; LB Manager | vt (Virtual Transport)</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon-dark.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">vt <span class="m-thin">(Virtual Transport)</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li>
              <a href="introduction.html">Introduction</a>
              <ol>
                <li><a href="context.html">Context</a></li>
                <li><a href="active-messenger.html">Active Messenger</a></li>
                <li><a href="collection.html">Virtual Context Collection</a></li>
                <li><a href="collective.html">Collectives</a></li>
                <li><a href="group.html">Group Manager</a></li>
                <li><a href="location.html">Location Manager</a></li>
                <li><a href="objgroup.html">Object Group Manager</a></li>
                <li><a href="pipe.html">Pipe Manager</a></li>
                <li><a href="pool.html">Memory Pool</a></li>
                <li><a href="rdmahandle.html">RDMA Handle Manager</a></li>
                <li><a href="registry.html">Registry</a></li>
                <li><a href="scheduler.html">Scheduler</a></li>
                <li><a href="term.html">Termination Detector</a></li>
                <li><a href="trace.html">Tracing</a></li>
              </ol>
            </li>
            <li>
              <a href="learn.html">Learn</a>
              <ol>
                <li><a href="vt-build.html">How to Build</a></li>
                <li><a href="tutorial.html">Tutorial</a></li>
                <li><a href="examples.html">Examples</a></li>
              </ol>
            </li>
            <li><a href="pages.html">Pages</a></li>
            <li>
              <a href="namespaces.html">Namespaces</a>
              <ol>
                <li><a href="namespacevt.html">vt</a></li>
                <li><a href="namespacevt_1_1collective.html">vt::collective</a></li>
                <li><a href="namespacevt_1_1debug.html">vt::debug</a></li>
                <li><a href="namespacevt_1_1group.html">vt::group</a></li>
                <li><a href="namespacevt_1_1location.html">vt::location</a></li>
                <li><a href="namespacevt_1_1messaging.html">vt::messaging</a></li>
                <li><a href="namespacevt_1_1objgroup.html">vt::objgroup</a></li>
                <li><a href="namespacevt_1_1pipe.html">vt::pipe</a></li>
                <li><a href="namespacevt_1_1rdma.html">vt::rdma</a></li>
                <li><a href="namespacevt_1_1runtime.html">vt::runtime</a></li>
                <li><a href="namespacevt_1_1term.html">vt::term</a></li>
                <li><a href="namespacevt_1_1vrt.html">vt::vrt</a></li>
              </ol>
            </li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="5">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li>
              <a href="https://github.com/DARMA-tasking/vt">GitHub</a>
              <ol>
                <li><a href="https://github.com/DARMA-tasking/checkpoint">Checkpoint</a></li>
                <li><a href="https://github.com/DARMA-tasking/detector">Detector</a></li>
                <li><a href="https://github.com/DARMA-tasking/LB-analysis-framework">LBAF</a></li>
                <li><a href="https://github.com/DARMA-tasking/checkpoint-member-analyzer">Checkpoint Analyzer</a></li>
                <li><a href="https://github.com/DARMA-tasking/DARMA-tasking.github.io">Documentation</a></li>
              </ol>
            </li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="index.html">DARMA</a> &raquo;</span>
          <span class="m-breadcrumb"><a href="introduction.html">Introduction</a> &raquo;</span>
          LB Manager
        </h1>
<p>Manage load balancers</p><p>The LB manager component <code><a href="structvt_1_1vrt_1_1collection_1_1balance_1_1_l_b_manager.html" class="m-doc">vt::<wbr />vrt::<wbr />collection::<wbr />balance::<wbr />LBManager</a></code>, accessed via <code><a href="namespacevt.html#a05187076eac8c66c9951b062b0955520" class="m-doc">vt::<wbr />theLBManager()</a></code> manages and coordinates instances of load balancers. It counts collections as they call <code>nextPhase</code> to ensure they are all ready before load balancing begins. It reads the command-line arguments or LB specification file to determine which load balancer to run.</p><p>To enable load balancing, the cmake flag <code class="m-code"><span class="o">-</span><span class="n">Dvt_lb_enabled</span><span class="o">=</span><span class="mi">1</span></code> should be passed during building. This also enables automatic instrumentation of work and communication performed by collection elements.</p><p>To run a load balancer at runtime:</p><ul><li>Pass <code>--vt_lb --vt_lb_name=&lt;LB&gt;</code> as a command line argument</li><li>Write a LB specification file <code>--vt_lb --vt_lb_file --vt_lb_file_name=&lt;FILE&gt;</code></li></ul><section id="lb-specification-file"><h2><a href="#lb-specification-file">LB Specification File</a></h2><p>The LB specification file allows users to specify which load balancer along with which LB-specific configuration parameters are passed to the load balancer instance for any given phase. The order of the LB phase specification lines in the file disambiguates lines&mdash;higher precedence for earlier lines.</p><p>The format of the LB specification file is:</p><pre class="m-code"><span class="p">[</span><span class="o">%</span><span class="p">]</span> <span class="o">&lt;</span><span class="err">$</span><span class="n">phase</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="err">$</span><span class="n">lbname</span><span class="o">&gt;</span> <span class="p">[</span><span class="err">$</span><span class="n">LB</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">arg</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">...</span> <span class="p">[</span><span class="err">$</span><span class="n">LB</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">arg</span><span class="o">-</span><span class="n">N</span><span class="p">]</span></pre><p>If a <code>%</code> is present, the line matches phases where: <code>current phase % $phase == 0</code>. Phase-specific lines (ones that specify a load balancer without a <code>%</code>) always always have precedence over <code>%</code> lines. The next token after the optional <code>%</code> and <code>$phase</code> is the name of the load balancer to invoke on that phase. After the load balancer name, <code>N</code> arguments to the load balancer are allowed to customize how the load balancer is run with the format of <code>key=value</code>. These arguments are the equivalent of passing <code>--vt_lb_args=&quot;A=test B=test2&quot;</code> on the command line.</p><p>The following is an example LB specification:</p><pre class="m-code"><span class="o">%</span><span class="mi">10</span> <span class="n">GossipLB</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span> <span class="n">f</span><span class="o">=</span><span class="mi">2</span> <span class="n">i</span><span class="o">=</span><span class="mi">10</span>
<span class="mi">0</span> <span class="n">HierarchicalLB</span> <span class="n">min</span><span class="o">=</span><span class="mf">0.9</span> <span class="n">max</span><span class="o">=</span><span class="mf">1.1</span> <span class="k">auto</span><span class="o">=</span><span class="nb">false</span>
<span class="o">%</span> <span class="mi">5</span> <span class="n">GreedyLB</span> <span class="n">min</span><span class="o">=</span><span class="mf">1.0</span>
<span class="mi">120</span> <span class="n">GreedyLB</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span> <span class="n">i</span><span class="o">=</span><span class="mi">3</span></pre></section><section id="load-balancers"><h2><a href="#load-balancers">Load balancers</a></h2><table class="m-table"><thead><tr><th>Load Balancer</th><th>Type</th><th>Description</th><th>Reference</th></tr></thead><tbody><tr><td>RotateLB</td><td>Testing</td><td>Rotate objects in a ring</td><td><code><a href="structvt_1_1vrt_1_1collection_1_1lb_1_1_rotate_l_b.html" class="m-doc">vt::<wbr />vrt::<wbr />collection::<wbr />lb::<wbr />RotateLB</a></code></td></tr><tr><td>RandomLB</td><td>Testing</td><td>Randomly migrate object with seed</td><td><code><a href="structvt_1_1vrt_1_1collection_1_1lb_1_1_random_l_b.html" class="m-doc">vt::<wbr />vrt::<wbr />collection::<wbr />lb::<wbr />RandomLB</a></code></td></tr><tr><td>GreedyLB</td><td>Centralized</td><td>Gather to central node apply min/max heap</td><td><code><a href="structvt_1_1vrt_1_1collection_1_1lb_1_1_greedy_l_b.html" class="m-doc">vt::<wbr />vrt::<wbr />collection::<wbr />lb::<wbr />GreedyLB</a></code></td></tr><tr><td>GossipLB</td><td>Distributed</td><td>Gossip-based protocol for fully distributed LB</td><td><code><a href="structvt_1_1vrt_1_1collection_1_1lb_1_1_gossip_l_b.html" class="m-doc">vt::<wbr />vrt::<wbr />collection::<wbr />lb::<wbr />GossipLB</a></code></td></tr><tr><td>HierarchicalLB</td><td>Hierarchical</td><td>Build tree to move objects nodes</td><td><code><a href="structvt_1_1vrt_1_1collection_1_1lb_1_1_hierarchical_l_b.html" class="m-doc">vt::<wbr />vrt::<wbr />collection::<wbr />lb::<wbr />HierarchicalLB</a></code></td></tr><tr><td>ZotltanLB</td><td>Hyper-graph Partitioner</td><td>Run Zoltan in hyper-graph mode to LB</td><td><code>vt::vrt::collection::lb::ZoltanLB</code></td></tr><tr><td>StatsMapLB</td><td>User-specified</td><td>Read file to determine mapping</td><td><code><a href="structvt_1_1vrt_1_1collection_1_1lb_1_1_stats_map_l_b.html" class="m-doc">vt::<wbr />vrt::<wbr />collection::<wbr />lb::<wbr />StatsMapLB</a></code></td></tr></tbody></table></section><section id="load-models"><h2><a href="#load-models">Object Load Models</a></h2><p>The performance-oriented load balancers described in the preceding section require a prediction of the loads each object will represent during the phases between one load balancing invocation and the next. These predictions are provided by load models, which are implementations of the <code>vt::vrt:collection::balance::LoadModel</code> interface. There are a number of general-purpose load model implementations provided by <strong><em>vt</em></strong>.</p><p>By default, <strong><em>vt</em></strong> uses a load model that predicts each object&#x27;s work load for all future phases will match its workload in the most recent past phase. The system also provides an interface for applications and users to arrange use of a non-default load model where that may be desirable for reasons such as performance experimentation, specialization to application details, or execution environment considerations. To install a custom load model, application code should call <code><a href="namespacevt.html#a05187076eac8c66c9951b062b0955520" class="m-doc">vt::<wbr />theLBManager()</a>-&gt;setLoadModel(user_model)</code>. To simplify implementation of custom load models, and allow them to benefit from future system-level improvements, we recommend that custom load models be composed atop the default model, which can be obtained by calling <code><a href="namespacevt.html#a05187076eac8c66c9951b062b0955520" class="m-doc">vt::<wbr />theLBManager()</a>-&gt;getBaseLoadModel()</code>.</p><p>Most provided load models are designed as composable filters inherited from the <code>vt::vrt:collection::balance::ComposedModel</code> class. This allows them to form a &#x27;model stack&#x27; in which each class makes a particular adjustment to the predictions generated, and relies on others above and below to refine them further. One exception is the <code>vt::vrt:collection::balance::RawData</code> model, which directly returns past values recorded in the instrumented statistics structures that <code>LBManager</code> provides.</p><p>To illustrate the design concept, the default model is implemented as a stack of two other components. At the base of the stack is a <code>RawData</code> model that will refer to the instrumented object load timings recorded by the system during preceding execution. Layered on that is a <code>vt::vrt:collection::balance::NaivePersistence</code> model that queries the underlying <code>RawData</code> model for the times taken in the most recent phase, and returns those same times as its prediction of the times those objects will take in all future phases.</p><p>The full set of load model classes provided with <strong><em>vt</em></strong> is as follows</p><p>| Load Model | Description | Reference | | ----------------&mdash;|--------------------------------------------------&mdash;|-------&mdash; | | <strong>Utilities</strong> | | LoadModel | Pure virtual interface class, which the following implement | <code>vt::vrt:collection::balance::LoadModel</code> | | ComposedModel | A convenience class for most implementations to inherit from, that passes unmodified calls through to an underlying model instance | <code>vt::vrt:collection::balance::ComposedModel</code> | | RawData | Returns historical data only, from the measured times | <code>vt::vrt:collection::balance::RawData</code> | | <strong>Transformers</strong> | Transforms the values computed by the composed model(s), agnostic to whether a query refers to a past or future phase | | Norm | When asked for a <code>WHOLE_PHASE</code> value, computes a specified l-norm over all subphases | <code>vt::vrt:collection::balance::Norm</code> | | SelectSubphases | Filters and remaps the subphases with data present in the underlying model | <code>vt::vrt:collection::balance::SelectSubphases</code> | | CommOverhead | Adds a specified amount of imputed &#x27;system overhead&#x27; time to each object&#x27;s work based on the number of messages received | <code>vt::vrt:collection::balance::CommOverhead</code> | | PerCollection | Maintains a set of load models associated with different collection instances, and passes queries for an object through to the model corresponding to its collection | <code>vt::vrt:collection::balance::PerCollection</code> | | <strong>Predictors</strong> | Computes values for future phase queries, and passes through past phase queries | | NaivePersistence | Passes through historical queries, and maps all future queries to the most recent past phase | <code>vt::vrt:collection::balance::NaivePersistence</code> | | PersistenceMedianLastN | Similar to NaivePersistence, except that it predicts based on a median over the N most recent phases | <code>vt::vrt:collection::balance::PersistenceMedianLastN</code> | | LinearModel | Computes a linear regression over on object&#x27;s loads from a number of recent phases | <code>vt::vrt:collection::balance::LinearModel</code> | | MultiplePhases | Computes values for future phases based on sums of the underlying model&#x27;s predictions for N corresponding future phases | <code>vt::vrt:collection::balance::MultiplePhases</code> |</p><p>All of the provided load balancers described in the previous section require that the installed load model provide responses to future phase queries for at least <code>PhaseOffset::NEXT_PHASE</code> (i.e. <code>0</code>), as the <strong>Predictors</strong> described above do.</p></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>vt (Virtual Transport). Created with <a href="https://doxygen.org/">Doxygen</a> 1.8.13 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
